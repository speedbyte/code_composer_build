/*-----------------------------------------------------------------------------+
|            ____    ___            ____    _____           ____               |
|           |    |  |   \   |      |    |     |    |    |  |                   |
|           |____|  |    |  |      |____|     |    |    |  |____               |
|           |    |  |    |  |      |    |     |    |    |       |              |
|           |    |  |___/   |____  |    |     |    |____|   ____|              |
|                                                                              |
|           T H E   S M A R T   E M B E D D E D   S O L U T I O N              |
|                                                                              |
+------------------------------------------------------------------------------+
| F I L E   I N F O R M A T I O N                                              |
+------------------------------------------------------------------------------+
|                                                                              |
|  Filename:  ADLATUS_Setup.c                                                  |
|                                                                              |
|  Comment:   This file includes the initialisation routine for the SMART      |
|             ADLATUS.                                                         |
|                                                                              |
+------------------------------------------------------------------------------+
| R E V I S I O N   H I S T O R Y                                              |
+------------------------------------------------------------------------------+
|
| Subversion Info:
| $Id: ADLATUS_Setup.c 4396 2008-11-04 09:26:32Z maennel $
| $HeadURL: http://smartsvn/svn/adlatusrepository/auslieferungen/S1NN/086350-S1NN-ADLATUS-TMS470R-MucSuc/20081201_S1NN_TMS470R_BlfIso-Source_V1.00/01_SW_Projekt/09_audilib/02_src/ADLATUS_Setup.c $
|
+------------------------------------------------------------------------------+
|      (c) SMART ELECTRONIC DEVELOPMENT GMBH - all rights reserved             |
+-----------------------------------------------------------------------------*/


/* ========================================================================== */
/* (1)  I N C L U D E S                                                       */
/* -------------------------------------------------------------------------- */
/*      C O N S T A N T   D E F I N I T I O N   F I L E S  (CDF)              */
/* ========================================================================== */
#include "ADLATUS_CompilerSwitches_cdf.h"

#include "ADLATUS_Global_cdf.h"
#include "ADLATUS_ConfigSystem_cdf.h"
#include "ADLATUS_ConfigProject_cdf.h"
#include "ADLATUS_CanHandler_cdf.h"

/* ========================================================================== */
/* (2)  I N C L U D E S                                                       */
/* -------------------------------------------------------------------------- */
/*      T Y P E   D E F I N I T I O N   F I L E S  (TDF)                      */
/* ========================================================================== */
#include "ADLATUS_Types_tdf.h"                 /* must be the first include   */
#include "ADLATUS_Main_tdf.h"                  /* must be the second include  */
#include "ADLATUS_Setup_tdf.h"
#include "ADLATUS_Timer_tdf.h"  
#include "ADLATUS_ConfigAdlatus_tdf.h"  
#include "ADLATUS_System_tdf.h"         
#include "ADLATUS_ServiceHandler_tdf.h" /* Layer 3 - Init / ErrorHandler      */
#include "ADLATUS_SessionHandler_tdf.h" /* Layer 2 - Init / ErrorHandler      */
#include "ADLATUS_Tp_tdf.h"             /* Layer 1 - Init / ErrorHandler      */
/*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
#include "ADLATUS_CanHandler_tdf.h"     /* Layer 0 - physical layer init      */
#include "ADLATUS_Hal_tdf.h"            /* Layer 0 - HAL init / ErrorHandler  */
/*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
/* Customer Files: - ADLATUS_KWP2000Customer_tdf.h                            */
/*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

#include "ADLATUS_Kwp2000Audi_tdf.h"      /* Layer 4 - Init / ErrorHandler    */

/* ========================================================================== */
/* (3)  C O M P I L E R   S W I T C H   S E T T I N G S                       */
/* -------------------------------------------------------------------------- */
/*      O N L Y   F O R   T H I S   M O D U L                                 */
/* ========================================================================== */
/* Global Compiler switch settings are done at ADLATUS_CompilerSwitches_CDF.h */
/*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
/* Local compiler switches: No Entry                                          */
/*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

/* ========================================================================== */
/* (4)  D A T A   S E C T I O N   D I R E C T I V E S                         */
/* -------------------------------------------------------------------------- */
/*      O N L Y   F O R   T H I S   M O D U L                                 */
/* ========================================================================== */
/* NO ENTRY                                                                   */

/* ========================================================================== */
/* (5)  L O C A L   D E F I N E S                                             */
/* -------------------------------------------------------------------------- */
/*      O N L Y   F O R   T H I S   M O D U L                                 */
/* ========================================================================== */
/* NO ENTRY                                                                   */

/* ========================================================================== */
/* (6)  L O C A L  T Y P E   D E F I N E S                                    */
/* -------------------------------------------------------------------------- */
/*      O N L Y   F O R   T H I S   M O D U L                                 */
/* ========================================================================== */
/* NO ENTRY                                                                   */

/* ========================================================================== */
/* (7)  L O C A L   V A R I A B L E S  / C O N S T A N T S                    */
/* -------------------------------------------------------------------------- */
/*      O N L Y   F O R   T H I S   M O D U L                                 */
/* ========================================================================== */
/* NO ENTRY                                                                   */

/* ========================================================================== */
/* (8)  L O C A L   F U N C T I O N   P R O T O T Y P E S                     */
/* -------------------------------------------------------------------------- */
/*      O N L Y   F O R   T H I S   M O D U L                                 */
/* ========================================================================== */
/* NO ENTRY                                                                   */

/* ========================================================================== */
/* (9)  G L O B A L   V A R I A B L E S                                       */
/* -------------------------------------------------------------------------- */
/*      D E F I N E D   W I T H I N   T H I S   M O D U L                     */
/* ========================================================================== */
/* No entry                                                                   */

/* ========================================================================== */
/* (10) F U N C T I O N   D E F I N I T I O N S                               */
/* -------------------------------------------------------------------------- */
/*      F O R   T H I S   M O D U L                                           */
/* ========================================================================== */


/* >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> */
/*                                                                            */
/* S I N G L E   C H A N N E L   S Y S T E M                                  */
/*                                                                            */
/* >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> */
#ifdef cs_CCsys_SingleChannelSystem /* -1-                                    */
/*----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------+
|    F U N C T I O N   I N F O R M A T I O N                                   |
+------------------------------------------------------------------------------+
|                                                                              |
|  Function Name:  FUN_CCsetup_InitAdlatus_V                                   |
|                                                                              |
|  Prototype at:   ADLATUS_Setup_TDF.h                                         |
|                                                                              |
|  Description:    Init-Routine for FlashCore.                                 |
|                                                                              |
|  Parameter:      --                                                          |
|                                                                              |
|  Return Value:    --                                                         |
|                                                                              |
+-----------------------------------------------------------------------------*/
void FUN_CCsetup_InitAdlatus_V ( void )
{

  /* ------------------------------------------------------------------------ */
  /*      I N I T   A D L A T U S                                             */
  /*      - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
  /*      Init System Buffer                                                  */
  /*                                                                          */
  /*--------------------------------------------------------------------------*/
  FUN_CCconsys_InitAllSystemBuffer_V ();

  /* ------------------------------------------------------------------------ */
  /*      I N I T   A D L A T U S                                             */
  /*      - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
  /*      Communication protocol stack                                        */
  /*                                                                          */
  /*      +-------------------+                                               */
  /*  (5) | Applikation Layer |                                               */
  /*      +-------------------+                                               */
  /*  (4) | Service Handler   |                                               */
  /*      +-------------------+                                               */
  /*  (3) | Session Handler   |                                               */
  /*      +-------------------+                                               */
  /*  (2) | Transport Layer   |                                               */
  /*      +-------------------+                                               */
  /*  (1) | Physical Layer    |                                               */
  /*      +-------------------+                                               */
  /*                                                                          */
  /* -------------------------------------------------------------------------*/

  /*--------------------------------------------------------------------------*/
  /* (1) Init CAN-Handler  -> Message Objects                                 */
  /*--------------------------------------------------------------------------*/
  FUN_CCcan_InitCan_V ((CANINTERFACE_ST*) &c_CCconsys_CanInterface_ST );

  /*--------------------------------------------------------------------------*/
  /* (2) Init Transport-Layer                                                 */
  /*--------------------------------------------------------------------------*/
  FUN_CCtp_Init_V   ( (TPINTERFACE_ST*  ) &c_CCconprj_TpInterface_ST   );

  /*--------------------------------------------------------------------------*/
  /* (3) Init Session-Handler                                                 */
  /*--------------------------------------------------------------------------*/
                                                            

  FUN_CCses_InitSessionLayer_V ( (SESSIONINTERFACE_ST*) &c_CCconsys_SessionInterface_ST );

  FUN_CCses_InitChannel_V  ( d_CCglo_Channel00,   \
                            t_InitCtrl_ST.ActiveSession_AUB[d_CCglo_Channel00], \
                            t_InitCtrl_ST.InitCondition_AUB[d_CCglo_Channel00] );
  /*--------------------------------------------------------------------------*/
  /* (4) Init Service Handler                                                 */
  /*--------------------------------------------------------------------------*/
  FUN_CCsrv_InitServiceHandler_V ( (SRVHANDLERINTERFACE_ST*) &c_CCconsys_SrvHandlerInterface_ST);
  /*--------------------------------------------------------------------------*/
  /* (5) Init KWP2000-Layer                                                   */
  /*--------------------------------------------------------------------------*/
  FUN_CCkwpaudi_InitKwp2000_V ((KWP2000INTERFACE_ST*) &c_CCconsys_Kwp2000Interface_ST[0]);

  /* ------------------------------------------------------------------------ */
  /* Init Operating System                                                    */
  /*--------------------------------------------------------------------------*/
  FUN_CCsys_InitOperatingSystem_V ((SYSTEMINTERFACE_ST*) &c_CCconsys_SystemInterface_ST );

  return;

} /* -+- END OF FUNCTION 'FUN_CCsetup_InitAdlatus_V' -+-+-+-+-+-+-+-+-+-+-+-+-*/

/*----------------------------------------------------------------------------*/
#endif /* -1- cs_CCsys_SingleChannelSystem                                    */
/* <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< */
/*                                                                            */
/*      E N D   O F   S I N G L E   C H A N N E L   S Y S T E M               */
/*                                                                            */
/* <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< */

/* >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> */
/*                                                                            */
/*      M U L T I   C H A N N E L   S Y S T E M                               */
/*                                                                            */
/* >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> */
#ifdef cs_CCsys_MultiChannelSystem /* -1-                                     */
/*----------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------+
|    F U N C T I O N   I N F O R M A T I O N                                   |
+------------------------------------------------------------------------------+
|                                                                              |
|  Function Name:  FUN_CCsetup_InitAdlatus_V                                   |
|                                                                              |
|  Prototype at:   ADLATUS_Setup_TDF.h                                         |
|                                                                              |
|  Description:    Init-Routine for FlashCore.                                 |
|                                                                              |
|  Parameter:      --                                                          |
|                                                                              |
|  Return Value:    --                                                         |
|                                                                              |
+-----------------------------------------------------------------------------*/
void FUN_CCsetup_InitAdlatus_V ( void )
{
  UBYTE t_Channel_UB;

  /* ------------------------------------------------------------------------ */
  /* Init System Buffer                                                       */
  /*--------------------------------------------------------------------------*/
  FUN_CCconsys_InitAllSystemBuffer_V ();

  /* ------------------------------------------------------------------------ */
  /* Init Operating System                                                    */
  /*--------------------------------------------------------------------------*/
  FUN_CCsys_InitOperatingSystem_V ((SYSTEMINTERFACE_ST*) &c_CCconsys_SystemInterface_ST );

  /* ------------------------------------------------------------------------ */
  /*      I N I T   A D L A T U S                                             */
  /*      - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
  /*      Communication protocol stack                                        */
  /*                                                                          */
  /*      +-------------------+                                               */
  /*  (5) | Applikation Layer |                                               */
  /*      +-------------------+                                               */
  /*  (4) | Service Handler   |                                               */
  /*      +-------------------+                                               */
  /*  (3) | Session Handler   |                                               */
  /*      +-------------------+                                               */
  /*  (2) | Transport Layer   |                                               */
  /*      +-------------------+                                               */
  /*  (1) | Physical Layer    |                                               */
  /*      +-------------------+                                               */
  /*                                                                          */
  /* -------------------------------------------------------------------------*/
  /*--------------------------------------------------------------------------*/
  /* (1) Init CAN-Handler  -> Message Objects                                 */
  /*--------------------------------------------------------------------------*/
  FUN_CCcan_InitCan_V ((CANINTERFACE_ST*) &c_CCconsys_CanInterface_ST );
  
  /*--------------------------------------------------------------------------*/
  /* (2) Init Transport-Layer                                                 */
  /*--------------------------------------------------------------------------*/
  FUN_CCtp_Init_V   ( (TPINTERFACE_ST*  ) &c_CCconprj_TpInterface_ST);
  /*--------------------------------------------------------------------------*/
  /* (3) Init Session-Handler                                                 */
  /*--------------------------------------------------------------------------*/
  FUN_CCses_InitSessionLayer_V ( (SESSIONINTERFACE_ST*) &c_CCconsys_SessionInterface_ST );

  /*--------------------------------------------------------------------------*/
  /* (4) Init Service Handler                                                 */
  /*--------------------------------------------------------------------------*/
  FUN_CCsrv_InitServiceHandler_V ( (SRVHANDLERINTERFACE_ST*) &c_CCconsys_SrvHandlerInterface_ST);
  /*--------------------------------------------------------------------------*/
  /* (5) Init KWP2000-Layer                                                   */
  /*--------------------------------------------------------------------------*/
  FUN_CCkwpaudi_InitKwp2000_V ((KWP2000INTERFACE_ST*) &c_CCconsys_Kwp2000Interface_ST[0]));

  /*==========================================================================*/
  /* -1- Init Chanel evaluation                                               */
  /*==========================================================================*/
  switch ( t_InitCtrl_ST.ActiveChannel_UB)
  {
    /*------------------------------------------------------------------------*/
    /*                                                                        */
    /* All channels                                                           */
    /*                                                                        */
    /*------------------------------------------------------------------------*/
    case d_CCglo_AllChannels:

      /*======================================================================*/
      /* -3- Init all channels                                                */
      /*======================================================================*/
      for (t_Channel_UB = 0; t_Channel_UB < d_CCconsys_NbrOfLogChannel; t_Channel_UB++)
      {
        /*--------------------------------------------------------------------*/
        /* Init channel x                                                     */
        /*--------------------------------------------------------------------*/
        FUN_CCses_InitChannel_V ( (UBYTE) t_Channel_UB,                                  \
                                  (UBYTE) t_InitCtrl_ST.ActiveSession_AUB[t_Channel_UB], \
                                  (UBYTE) t_InitCtrl_ST.InitCondition_AUB[t_Channel_UB] );

      } /* -3- END OF for (..) -----------------------------------------------*/

      break;
      /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

    /*------------------------------------------------------------------------*/
    /*                                                                        */
    /* single channel                                                         */
    /*                                                                        */
    /*------------------------------------------------------------------------*/
    default:
      /*----------------------------------------------------------------------*/
      /* Init channel x                                                       */
      /*----------------------------------------------------------------------*/
      FUN_CCses_InitChannel_V ( (UBYTE) t_InitCtrl_ST.ActiveChannel_UB,                                  \
                                (UBYTE) t_InitCtrl_ST.ActiveSession_AUB[t_InitCtrl_ST.ActiveChannel_UB], \
                                (UBYTE) t_InitCtrl_ST.InitCondition_AUB[t_InitCtrl_ST.ActiveChannel_UB] );

      break;
      /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*/

  } /* -1- END OF switch (..) ------------------------------------------------*/


  return;

} /* -+- END OF FUNCTION 'FUN_CCsetup_InitAdlatus_V' -+-+-+-+-+-+-+-+-+-+-+-+-*/


/*----------------------------------------------------------------------------*/
#endif /* -1- cs_CCsys_MultiChannelSystem                                     */
/* <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< */
/*                                                                            */
/*      E N D   O F   M U L T I    C H A N N E L   S Y S T E M                */
/*                                                                            */
/* <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< */


/* ========================================================================== */
/*      E N D   O F   F I L E                                                 */
/* ========================================================================== */
